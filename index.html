<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crimecity â€“ Road Loop Test</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: system-ui, sans-serif;
      color: #eee;
    }

    #game-wrap {
      text-align: center;
    }

    canvas {
      border: 3px solid #444;
      background: #284028; /* grass */
      image-rendering: pixelated;
      display: block;
      margin: 0 auto;
    }

    #info {
      margin-top: 8px;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div id="game-wrap">
    <canvas id="game" width="800" height="600"></canvas>
    <div id="info">
      Move with <b>WASD</b> or <b>Arrow keys</b>.<br>
      When you drive off any edge of the map, you appear on the opposite side.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    const player = {
      x: WIDTH / 2,
      y: HEIGHT / 2,
      size: 20,
      speed: 3
    };

    const keys = {};

    window.addEventListener("keydown", (e) => {
      keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener("keyup", (e) => {
      keys[e.key.toLowerCase()] = false;
    });

    function update() {
      let dx = 0;
      let dy = 0;

      if (keys["w"] || keys["arrowup"]) dy -= 1;
      if (keys["s"] || keys["arrowdown"]) dy += 1;
      if (keys["a"] || keys["arrowleft"]) dx -= 1;
      if (keys["d"] || keys["arrowright"]) dx += 1;

      // Normalize diagonal movement
      if (dx !== 0 && dy !== 0) {
        const inv = 1 / Math.sqrt(2);
        dx *= inv;
        dy *= inv;
      }

      player.x += dx * player.speed;
      player.y += dy * player.speed;

      // WORLD WRAP: leave one edge, enter from opposite edge
      if (player.x < 0)        player.x = WIDTH;
      if (player.x > WIDTH)    player.x = 0;
      if (player.y < 0)        player.y = HEIGHT;
      if (player.y > HEIGHT)   player.y = 0;
    }

    function drawRoads() {
      // background (grass)
      ctx.fillStyle = "#284028";
      ctx.fillRect(0, 0, WIDTH, HEIGHT);

      // road color
      ctx.fillStyle = "#3f3f3f";

      // main horizontal road (middle)
      const roadWidth = 90;
      ctx.fillRect(0, HEIGHT / 2 - roadWidth / 2, WIDTH, roadWidth);

      // main vertical road (middle)
      ctx.fillRect(WIDTH / 2 - roadWidth / 2, 0, roadWidth, HEIGHT);

      // outer "ring" roads (top, bottom, left, right)
      const ringWidth = 60;

      // top
      ctx.fillRect(0, 40, WIDTH, ringWidth);
      // bottom
      ctx.fillRect(0, HEIGHT - 40 - ringWidth, WIDTH, ringWidth);
      // left
      ctx.fillRect(40, 0, ringWidth, HEIGHT);
      // right
      ctx.fillRect(WIDTH - 40 - ringWidth, 0, ringWidth, HEIGHT);

      // simple lane markings on middle cross
      ctx.strokeStyle = "#d8d8d8";
      ctx.setLineDash([10, 10]);
      ctx.lineWidth = 2;

      // horizontal
      ctx.beginPath();
      ctx.moveTo(0, HEIGHT / 2);
      ctx.lineTo(WIDTH, HEIGHT / 2);
      ctx.stroke();

      // vertical
      ctx.beginPath();
      ctx.moveTo(WIDTH / 2, 0);
      ctx.lineTo(WIDTH / 2, HEIGHT);
      ctx.stroke();

      ctx.setLineDash([]);
    }

    function drawPlayer() {
      // car body
      ctx.fillStyle = "#00bcd4";
      ctx.fillRect(
        player.x - player.size / 2,
        player.y - player.size / 2,
        player.size,
        player.size
      );

      // small front window
      ctx.fillStyle = "#e0f7fa";
      ctx.fillRect(
        player.x - player.size / 2 + 3,
        player.y - player.size / 2 + 3,
        player.size - 6,
        6
      );
    }

    function loop() {
      update();
      drawRoads();
      drawPlayer();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
