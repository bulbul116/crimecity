<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crimecity â€“ Map Test</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: system-ui, sans-serif;
      color: #eee;
    }

    #game-wrap {
      text-align: center;
    }

    canvas {
      border: 3px solid #444;
      background: #000;
      image-rendering: pixelated;
      display: block;
      margin: 0 auto;
    }

    #info {
      margin-top: 8px;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div id="game-wrap">
    <canvas id="game" width="800" height="600"></canvas>
    <div id="info">
      Move with <b>WASD</b> or <b>Arrow keys</b>.<br>
      When you drive off any edge of the map, you appear on the opposite side.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    // Load your city map image
    const mapImage = new Image();
    mapImage.src = "citymap.png"; // make sure this file exists in the repo root
    let mapLoaded = false;
    mapImage.onload = () => {
      mapLoaded = true;
    };

    const player = {
      x: WIDTH / 2,
      y: HEIGHT / 2,
      size: 20,
      speed: 3
    };

    const keys = {};

    window.addEventListener("keydown", (e) => {
      keys[e.key.toLowerCase()] = true;
    });

    window.addEventListener("keyup", (e) => {
      keys[e.key.toLowerCase()] = false;
    });

    function update() {
      let dx = 0;
      let dy = 0;

      if (keys["w"] || keys["arrowup"]) dy -= 1;
      if (keys["s"] || keys["arrowdown"]) dy += 1;
      if (keys["a"] || keys["arrowleft"]) dx -= 1;
      if (keys["d"] || keys["arrowright"]) dx += 1;

      // Normalize diagonal movement
      if (dx !== 0 && dy !== 0) {
        const inv = 1 / Math.sqrt(2);
        dx *= inv;
        dy *= inv;
      }

      player.x += dx * player.speed;
      player.y += dy * player.speed;

      // WORLD WRAP: leave one edge, enter from opposite edge
      if (player.x < 0)        player.x = WIDTH;
      if (player.x > WIDTH)    player.x = 0;
      if (player.y < 0)        player.y = HEIGHT;
      if (player.y > HEIGHT)   player.y = 0;
    }

    function drawBackground() {
      if (mapLoaded) {
        // Draw city map scaled to canvas
        ctx.drawImage(mapImage, 0, 0, WIDTH, HEIGHT);
      } else {
        // Fallback background while image loads
        ctx.fillStyle = "#284028";
        ctx.fillRect(0, 0, WIDTH, HEIGHT);
      }
    }

    function drawPlayer() {
      // car body
      ctx.fillStyle = "#00bcd4";
      ctx.fillRect(
        player.x - player.size / 2,
        player.y - player.size / 2,
        player.size,
        player.size
      );

      // front window
      ctx.fillStyle = "#e0f7fa";
      ctx.fillRect(
        player.x - player.size / 2 + 3,
        player.y - player.size / 2 + 3,
        player.size - 6,
        6
      );
    }

    function loop() {
      update();
      drawBackground();
      drawPlayer();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
