<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Top View City – Loop Road</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: system-ui, sans-serif;
      color: #fff;
    }

    #game-container {
      text-align: center;
    }

    canvas {
      border: 3px solid #444;
      background: #2f3b24; /* grass */
      image-rendering: pixelated;
    }

    #info {
      margin-top: 8px;
      font-size: 14px;
      color: #ccc;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="game" width="800" height="600"></canvas>
    <div id="info">
      Move with <b>WASD</b> or <b>Arrow Keys</b>. <br>
      Follow the road: when you leave one side, you appear on the opposite side.
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    // Player (car) settings
    const player = {
      x: WIDTH / 2,
      y: HEIGHT / 2,
      size: 18,
      speed: 2.8
    };

    const keys = {};
    window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    window.addEventListener("keyup",   e => keys[e.key.toLowerCase()] = false);

    function update() {
      let dx = 0, dy = 0;

      if (keys["w"] || keys["arrowup"])    dy -= 1;
      if (keys["s"] || keys["arrowdown"])  dy += 1;
      if (keys["a"] || keys["arrowleft"])  dx -= 1;
      if (keys["d"] || keys["arrowright"]) dx += 1;

      // Normalise diagonal movement
      if (dx !== 0 && dy !== 0) {
        const inv = 1 / Math.sqrt(2);
        dx *= inv;
        dy *= inv;
      }

      player.x += dx * player.speed;
      player.y += dy * player.speed;

      // WORLD WRAP – leave one edge, appear at opposite edge
      if (player.x < 0)          player.x = WIDTH;
      if (player.x > WIDTH)      player.x = 0;
      if (player.y < 0)          player.y = HEIGHT;
      if (player.y > HEIGHT)     player.y = 0;
    }

    function drawRoads() {
      ctx.fillStyle = "#2f3b24"; // grass
      ctx.fillRect(0, 0, WIDTH, HEIGHT);

      // Road color
      ctx.fillStyle = "#404040";

      // Main horizontal road across middle
      ctx.fillRect(0, HEIGHT / 2 - 45, WIDTH, 90);

      // Main vertical road across middle
      ctx.fillRect(WIDTH / 2 - 45, 0, 90, HEIGHT);

      // Outer ring road (simple rounded rectangle)
      const ringWidth = 60;
      ctx.beginPath();
      ctx.roundRect(
        40, 40,
        WIDTH - 80,
        HEIGHT - 80,
        80
      );
      ctx.lineWidth = ringWidth;
      ctx.strokeStyle = "#404040";
      ctx.stroke();

      // Small side streets (examples)
      ctx.fillRect(120, HEIGHT / 2 - 20, 140, 40);
      ctx.fillRect(WIDTH - 260, HEIGHT / 2 - 20, 140, 40);
      ctx.fillRect(WIDTH / 2 - 20, 120, 40, 140);
      ctx.fillRect(WIDTH / 2 - 20, HEIGHT - 260, 40, 140);

      // Lane markings - simple dashed lines
      ctx.strokeStyle = "#d7d7d7";
      ctx.lineWidth = 2;
      ctx.setLineDash([10, 10]);

      // Horizontal dashed line
      ctx.beginPath();
      ctx.moveTo(0, HEIGHT / 2);
      ctx.lineTo(WIDTH, HEIGHT / 2);
      ctx.stroke();

      // Vertical dashed line
      ctx.beginPath();
      ctx.moveTo(WIDTH / 2, 0);
      ctx.lineTo(WIDTH / 2, HEIGHT);
      ctx.stroke();

      ctx.setLineDash([]);
    }

    function drawPlayer() {
      // Car body
      ctx.fillStyle = "#00bcd4";
      ctx.fillRect(
        player.x - player.size / 2,
        player.y - player.size / 2,
        player.size,
        player.size
      );

      // simple front window
      ctx.fillStyle = "#e0f7fa";
      ctx.fillRect(
        player.x - player.size / 2 + 3,
        player.y - player.size / 2 + 3,
        player.size - 6,
        6
      );
    }

    function loop() {
      update();
      drawRoads();
      drawPlayer();
      requestAnimationFrame(loop);
    }

    // Polyfill for roundRect if needed
    if (!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
        if (typeof r === "number") r = {tl:r,tr:r,br:r,bl:r};
        this.beginPath();
        this.moveTo(x + r.tl, y);
        this.lineTo(x + w - r.tr, y);
        this.quadraticCurveTo(x + w, y, x + w, y + r.tr);
        this.lineTo(x + w, y + h - r.br);
        this.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);
        this.lineTo(x + r.bl, y + h);
        this.quadraticCurveTo(x, y + h, x, y + h - r.bl);
        this.lineTo(x, y + r.tl);
        this.quadraticCurveTo(x, y, x + r.tl, y);
        this.closePath();
        return this;
      };
    }

    loop();
  </script>
</body>
</html>
